<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Parody Stock Game</title>

  <!-- Tailwind & Chart.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    html,body{font-size:15px}
    #cashDisplay{font-size:1.4rem}
    button{font-size:1rem}
    /* iPad portrait / phones: stack vertically */
    @media (max-width:768px){
      .desk-grid{display:block}
      .full-w   {width:100%!important}
      .hide-xs  {display:none!important}
      #chartBox{height:300px}            /* keep chart visible */
    }
  </style>
</head>

<body class="bg-gray-900 text-white h-screen p-4 desk-grid grid-cols-12 grid-rows-6 gap-3">

  <!-- cash panel -->
  <div id="cashDisplay"
       class="full-w col-span-4 row-span-1 bg-gray-800 rounded flex
              items-center justify-center font-bold mb-3 lg:mb-0">
    Cash: $100.00
  </div>

  <!-- market-speed slider (top-centre) -->
  <div class="full-w col-span-4 col-start-5 row-span-1 bg-gray-800 rounded
              flex flex-col items-center justify-center px-4 py-2 text-xs
              mb-3 lg:mb-0">
    <label class="w-full mb-1 text-center lg:text-left">Market Speed</label>
    <input id="speed" type="range" min="100" max="2000" step="100" value="500"
           class="w-full">
    <span id="speedLabel" class="text-gray-400 mt-1">Tick every 0.5 s</span>
  </div>

  <!-- chart -->
  <div id="chartBox"
       class="full-w col-span-8 row-start-2 row-span-4 bg-gray-800 rounded
              p-3 flex">
    <canvas id="chart" class="w-full h-full"></canvas>
  </div>

  <!-- trade controls -->
  <div class="full-w col-span-4 row-start-2 row-span-2 bg-gray-800 rounded
              flex flex-col items-center gap-3 p-3 text-sm">
    <div class="flex w-full gap-2">
      <button class="flex-1 bg-gray-700 hover:bg-gray-600 py-1 rounded symBtn"
              data-sym="GGL">GGL</button>
      <button class="flex-1 bg-gray-700 hover:bg-gray-600 py-1 rounded symBtn"
              data-sym="NVD">NVD</button>
      <button class="flex-1 bg-gray-700 hover:bg-gray-600 py-1 rounded symBtn"
              data-sym="MPL">MPL</button>
    </div>
    <button id="buy"
            class="w-full bg-blue-600 hover:bg-blue-700 py-1 rounded
                   font-semibold">
      Buy 1 – $10.00
    </button>
    <button id="sell"
            class="w-full bg-red-600 hover:bg-red-700 py-1 rounded
                   font-semibold">
      Sell All (0)
    </button>
  </div>

  <!-- holdings + news -->
  <div class="full-w col-start-9 col-span-4 row-start-2 row-span-4
              bg-gray-800 rounded p-3 overflow-y-auto flex flex-col text-xs">
    <h2 class="text-base font-semibold mb-1">Holdings</h2>
    <table class="min-w-full text-left" id="table">
      <thead>
        <tr><th>#</th><th>Ticker</th><th class="hide-xs">Bought</th>
            <th class="hide-xs">P/L</th><th></th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <p id="empty" class="text-gray-500 mt-1">No holdings</p>
    <hr class="border-gray-600 my-2">
    <h2 class="text-base font-semibold mb-1">Market News</h2>
    <ul id="news" class="space-y-1"></ul>
  </div>

<script>
(function(){
/* ---------- helpers ---------- */
const $  = s => document.querySelector(s);
const $$ = s => [...document.querySelectorAll(s)];
const $,fmt = (c)=>(c/100).toFixed(2);

/* ---------- stock data ---------- */
const stocks = {
  GGL:{c:'#f87171', p:1000, h:[], t:null},
  NVD:{c:'#a78bfa', p: 800, h:[], t:null},
  MPL:{c:'#34d399', p:1200, h:[], t:null}
};
const SYM = Object.keys(stocks);
let act = 'GGL';

/* ---------- state ---------- */
let cash = 10000;  // cents
const bag = [];    // {id,s,b}
let speed = 500;

/* ---------- dom ---------- */
const cashEl  = $('#cashDisplay');
const buyBtn  = $('#buy');
const sellBtn = $('#sell');
const slider  = $('#speed');
const sLabel  = $('#speedLabel');

/* ---------- chart ---------- */
const ctx = $('#chart').getContext('2d');
const chart = new Chart(ctx,{
  type:'line',
  data:{labels:[],datasets:[{data:[],borderWidth:2,tension:.3,
                             borderColor:stocks[act].c,pointRadius:0}]},
  options:{animation:false,plugins:{legend:{display:false}},
           scales:{x:{display:false},
                   y:{ticks:{callback:v=>'$'+v.toFixed(2)}}}}
});
function draw(){
  const s = stocks[act];
  chart.data.labels = s.h.map((_,i)=>i);
  chart.data.datasets[0].data = s.h;
  chart.data.datasets[0].borderColor = s.c;
  chart.update();
}

/* ---------- ui ---------- */
function uiCash(){ cashEl.textContent='Cash: $'+fmt(cash); }
function uiBtns(){
  const p=stocks[act].p;
  buyBtn.textContent = `Buy 1 – $${fmt(p)}`;
  const n = bag.filter(h=>h.s===act).length;
  sellBtn.textContent = `Sell All (${n})`;
  sellBtn.disabled = !n;
  sellBtn.classList.toggle('opacity-50',!n);
}
function uiTable(){
  const tbody = $('#table tbody');
  tbody.innerHTML='';
  if(!bag.length){ $('#empty').style.display='block'; return;}
  $('#empty').style.display='none';
  bag.forEach((h,i)=>{
    const cur=stocks[h.s].p, pl=cur-h.b;
    tbody.insertAdjacentHTML('beforeend',`
      <tr>
        <td>${i+1}</td><td>${h.s}</td>
        <td class="hide-xs">$${fmt(h.b)}</td>
        <td class="hide-xs ${pl>=0?'text-green-400':'text-red-500'}">
          ${pl>=0?'+':''}$${fmt(pl)}</td>
        <td><button data-id="${h.id}"
                    class="bg-yellow-600 hover:bg-yellow-700 px-1 rounded">
            Sell</button></td>
      </tr>`);
  });
}

/* ---------- engine ---------- */
const MAX=400;
function swing(p){
  let d = Math.round(((Math.random()+Math.random()+Math.random())/3-.5)*p*.05);
  if(Math.random()<.05){
    const s=(.1+Math.random()*.4)*p;
    d+=Math.round(s)*(Math.random()<.5?-1:1);
  }
  return d;
}
function tick(sym){
  const s=stocks[sym];
  let np=s.p+swing(s.p);
  np=Math.max(100,Math.max(np,Math.floor(s.p*.3)));
  s.p=np;
  s.h.push(np/100);
  if(s.h.length>MAX)s.h.shift();
  if(sym===act){ draw(); uiBtns(); }
  uiTable();
}
function run(sym){
  clearInterval(stocks[sym].t);
  const j=.7+Math.random()*.6;
  stocks[sym].t=setInterval(()=>tick(sym),speed*j);
}
function restart(){ SYM.forEach(run); }

/* ---------- news ---------- */
const NEWS={
  GGL:['Gaggle antitrust probe','Gaggle AI passes test','Gaggle CEO posts meme'],
  NVD:['NaVideo 1000-core GPU','Crypto crash hits NaVideo','Analysts love NaVideo'],
  MPL:['Mapple unveils iToaster','Mapple Vision dominates','Mapple smashes EPS']
};
function news(){
  const sym=SYM[Math.floor(Math.random()*SYM.length)];
  const txt=NEWS[sym][Math.floor(Math.random()*NEWS[sym].length)];
  const pct=(5+Math.random()*20)*(Math.random()<.5?-1:1);
  stocks[sym].p=Math.max(100,Math.round(stocks[sym].p*(1+pct/100)));
  $('#news').insertAdjacentHTML('afterbegin',`
     <li><b>${sym}</b>: ${txt}
         <span class="${pct>0?'text-green-400':'text-red-500'}">
           ${pct>0?'▲':'▼'}${Math.abs(pct)}%</span></li>`);
}
setInterval(news,30000);

/* ---------- events ---------- */
$$('.symBtn').forEach(b=>b.addEventListener('click',e=>{
  act=e.target.dataset.sym;
  $$('.symBtn').forEach(x=>x.classList.toggle('bg-gray-600',x.dataset.sym===act));
  uiBtns(); draw();
}));
buyBtn.addEventListener('click',()=>{
  const p=stocks[act].p; if(cash<p)return;
  cash-=p; bag.push({id:Date.now(),s:act,b:p});
  uiCash(); uiBtns(); uiTable();
});
sellBtn.addEventListener('click',()=>{
  const p=stocks[act].p;
  bag.filter(h=>h.s===act).forEach(()=>cash+=p);
  for(let i=bag.length-1;i>=0;i--)if(bag[i].s===act)bag.splice(i,1);
  uiCash(); uiBtns(); uiTable();
});
$('#table tbody').addEventListener('click',e=>{
  if(e.target.tagName!=='BUTTON')return;
  const id=+e.target.dataset.id;
  const idx=bag.findIndex(h=>h.id===id);
  if(idx>-1){ cash+=stocks[bag[idx].s].p; bag.splice(idx,1);
              uiCash(); uiBtns(); uiTable(); }
});
slider.addEventListener('input',e=>{
  speed=+e.target.value;
  sLabel.textContent=`Tick every ${(speed/1000).toFixed(1)} s`;
  restart();
});

/* ---------- boot ---------- */
function init(){
  uiCash(); uiBtns(); uiTable();
  $$('.symBtn')[0].classList.add('bg-gray-600');
  SYM.forEach(s=>stocks[s].h=[stocks[s].p/100]); // seed history
  draw(); restart();
}
document.addEventListener('DOMContentLoaded',init);
})();
</script>
</body>
</html>